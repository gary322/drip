# Progress

## Current

- **Phase**: phase 1 + phase 2 complete, phase 3 in progress
- **Task**: strict validator service + channel runtime foundation implemented
- **Status**: in progress

## Original goal

Enforce full head-to-toe capture and deliver try-on via iMessage, ChatGPT, WhatsApp, Telegram

## Completed

- Created and activated spec `omni-channel-fullbody-production`.
- Reviewed current `fashion-mcp` architecture and integration surfaces.
- Reviewed `imsg` capabilities and RPC model.
- Wrote detailed research, requirements, architecture design, and 41-task implementation plan.
- Added migration `004_channel_and_photo_validation.sql` for photo validation metadata.
- Added strict validator config and client flow in `src/photos/fullBody.ts`.
- Persisted per-photo validation reports and primary-photo flags in profile repository helpers.
- Updated `profile.ingestPhotos` to enforce full-body validation with structured failure reasons.
- Updated try-on tools/workers to require approved primary full-body photo when enforcement is enabled.
- Added and passed new tests (`fullBody`, repository integration, worker integration) and E2E script (`scripts/e2e_fullbody_enforcement.mjs`).
- Added `services/fullbody-validator` FastAPI service with strict quality/pose checks and `/validate` + `/healthz` endpoints.
- Added Python tests for validator service and passed them.
- Added channel runtime migration (`005`, `006`) and channel repository with integration tests.
- Added shared channel envelope schemas and channel intent/router modules with tests.
- Updated health endpoint to include strict validator readiness.

## Learnings

- Existing code already has async try-on, Stripe budget gating, and baseline full-body checks.
- Current full-body check is heuristic and must be upgraded to strict pose-based validation.
- iMessage integration is feasible via `imsg` but requires macOS bridge hosts outside standard AWS Linux runtime.
- Strict enforcement can be rolled out incrementally via `FULLBODY_VALIDATOR_MODE` (`heuristic` -> `strict`) without breaking local flows.
- Channel idempotency for outbound sends must use a non-partial unique index to support Postgres `ON CONFLICT` properly.

## Blockers

- No blockers for current completed phases.
- Remaining dependency: provision real channel credentials (Meta/Telegram/Auth0) and iMessage bridge host for adapter rollout.

## Next steps

1. Implement Phase 3.5 and 3.6: account-linking flow + outbound sender worker orchestration.
2. Implement Phase 4: WhatsApp and Telegram adapters (webhook + sender clients).
3. Implement Phase 5: iMessage bridge service integration with `imsg rpc`.
